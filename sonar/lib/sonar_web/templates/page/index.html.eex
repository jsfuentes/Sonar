<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Display Webcam Stream</title>
 
<link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,800&display=swap" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    font-family: 'Open Sans', sans-serif;

    background-color: #ebecf0;


}
body {
    position: relative;
    font-size: 64px;
}

#container {
	margin: 0px auto;
    margin-left: auto;
    margin-right: auto;
    top: 38%;
    left: 0;
    right: 0;
	width: 90%;
	height: 35%;
	/* border: 10px #333 solid; */
    z-index: 2;
    position: absolute;
    box-shadow: 
    6px 6px 12px 3px rgba(90,90,90,0.3),
    -4px -4px 12px 6px rgba(255,255,255,0.3);
    border-radius: 20px;
}

#videoElement {
	width: 100%;
	height: 100%;
	background-color: hsl(228, 14%, 96%);
  border-radius: 20px;
  border-radius: 20px;
  object-fit: cover;
}

#bg {
  /* The image used */
  background-image: url("./sf.png");

  /* Add the blur effect */
  filter: blur(4px);
  -webkit-filter: blur(4px);

  /* Full height */
  height: 30%;
  width: 100%;

  /* Center and scale the image nicely */
  background-position: bottom;
  background-repeat: no-repeat;
  background-size: cover;
  z-index: 1;
  position: absolute;

}

#clicker {
  background-color: #4CAF50; /* Green */
  border: none;
  color: white;
  padding: 15px 32px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-size: 16px;
  width: 50%;
  height: 20%;
  position: absolute;
  bottom: 3%;
  margin-left: auto;
    margin-right: auto;
    left: 0;
    right: 0;
    font-family: 'Open Sans', sans-serif;


}


.button {
  height: 4em;
  width: 90%;
  border-radius: 40px;
  display: flex;
/*   background-image: 
    linear-gradient(90deg, #23c3ab, #53dbbb); */
  color: #666;
  letter-spacing: 3px;
  font-size: 1.2em;
  /* font-weight: 400; */
  justify-content: center;
  align-items: center;
  box-shadow: 
    6px 6px 12px 3px rgba(90,90,90,0.3),
    -4px -4px 12px 6px rgba(255,255,255,0.3);

  transition: all .3s ease;
  position: absolute;
  bottom: 4%;
  margin-left: auto;
    margin-right: auto;
    left: 0;
    right: 0;

    font-family: 'Open Sans', sans-serif;

}

/* .button:hover {
  letter-spacing: 5px;
  box-shadow: 
    10px 10px 30px 10px rgba(90,90,90,0.3),
    -8px -8px 10px 10px rgba(255,255,255,0.3);
} */

.button:active {
  letter-spacing: 3px;
  box-shadow:
    inset 4px 4px 8px 1px rgba(90,90,90,0.3),
    inset -1px -1px 3px 1px rgba(255,255,255,0.3);
}

.button:hover {
    cursor: pointer;

}

#title {
    width: 100%;
    text-align: center;
    position: absolute;
    top: 21%;
}

#logo {
    position: absolute;
    top: 5%;
    margin-left: auto;
    margin-right: auto;
    left: 0;
    right: 0;
    width: 15rem;
    height: 15rem;
    box-shadow: 
    3px 3px 8px 3px rgba(90,90,90,0.3),
    -4px -4px 8px 6px rgba(255,255,255,0.3);
    padding: 10px;
    border-radius: 100%;
}

#Name {
    color: #687083;
    line-height: 0.5rem;
    font-weight: 800;
    font-size: 1.25em;
}

#desc {
  margin-top: -25px;
  color: #b8bbc2
}

strong {
    color: #8a909e;
}
</style>
</head>
 
<body>
    
    <img id="logo" src="<%= Routes.static_path(@conn, "/images/view.svg") %>" />

<div id="title"><p id="Name">Sonar</p><p id="desc"><strong>sight</strong> for the blind.</p></div>
<!-- <div class="bg-image"> -->
</div>
    
<div id="container">
    
	<video autoplay="true" id="videoElement">
	
    </video>
    <!-- <img id="videoElement" src="S4_Dog.jpg"/> -->

</div>

<!-- <div id="output"></div> -->

<!-- <div class="loader loader--style1" title="0">
    <svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
     width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
    <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
      s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
      c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z"/>
    <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
      C22.32,8.481,24.301,9.057,26.013,10.047z">
      <animateTransform attributeType="xml"
        attributeName="transform"
        type="rotate"
        from="0 20 20"
        to="360 20 20"
        dur="0.5s"
        repeatCount="indefinite"/>
      </path>
    </svg>
  </div> -->
<!-- <div id="bg"></div> -->
<!-- <button id="clicker">hello</button> -->
<a><div class="button">
    <strong>See</strong>
    </div></a>

<script>

    function detectImage(imageURI) {
      console.log({imageURI});
      const image = imageURI.replace(/^data:image.+;base64,/, '');
      console.log({image});
      axios.post('/api/image', {image})
        .then(resp => {
          console.log(resp.data.audioContent);
          playSound(resp.data.audioContent);
        });
    }

    function playSound(sound) {
        var audio = new Audio("data:audio/mp3;base64," + sound);
        audio.play();
    }

    function captureImage() {
        // var output = $("#output");
        var video = $("#videoElement").get(0);
        var canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext('2d')
              .drawImage(video, 0, 0, canvas.width, canvas.height);

        const image = canvas.toDataURL('image/jpeg', 0.5);
        return image;
        //var img = document.createElement("img");
        // output.prepend(img);
    }

$(document).ready(function () {
    $( ".button" ).click(function() {
        
        var imgData = captureImage();
        detectImage(imgData);
    });

});
var video = document.querySelector("#videoElement");

if (navigator.mediaDevices.getUserMedia) {
  navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" }})
    .then(function (stream) {
      video.srcObject = stream;
    })
    .catch(function (err0r) {
      console.log("Something went wrong!");
    });
}
</script>
</body>
</html>